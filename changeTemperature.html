<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.17/angular.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <title>Điều chỉnh nhiệt độ</title>
        <link rel="stylesheet" href="./css/themify-icons/themify-icons.css">
        <link rel="stylesheet" href="./css/style.css">
        <link rel="stylesheet" href="./css/changeTemperature.css">
        <link rel="stylesheet" href="./css/homepage.css">
    </head>
    <body ng-app="myapp" ng-controller="recordController" id="content_body" onload="startTime(); startTime1()">
        <div class="container">
            <div class="content-body">
                <!-- menu bar bên trái -->
                <div class="menu-bar">
                    <h1 class="menu-title">
                        Menu
                    </h1>
                    <div>
                        <i class="ti-user"></i>
                        <a href="profile.html">
                            <div class="menu-btn">Tài khoản</div>
                        </a>
                    </div>
                    <div>
                        <i class="ti-settings"></i>
                        <a href="setting.html">
                            <div class="menu-btn">Cài đặt</div>
                        </a>
                    </div>
                    <div>
                        <i class="ti-notepad"></i>
                        <a href="record.html">
                            <div class="menu-btn">Hồ sơ hệ thống</div>
                        </a>
                    </div>
                    <div>
                        <i class="ti-support"></i>
                        <a href="guide.html">
                            <div class="menu-bt">Hướng dẫn sử dụng</div>
                        </a>
                    </div>
                </div>

                <!-- phần chính bên phải -->
                <div class="main-content">
                    <!-- thanh header bên trên -->
                    <div class="header-bar">
                        <div class="search-bar">
                            <input type="text" placeholder="Search..">
                        </div>
                        <a href="homepage.html"><div class="header-btn">Trang chủ</div></a>
                        <a href="#"><div class="header-btn">Về chúng tôi</div></a>
                        <a href="#"><div class="header-btn">Hỗ trợ</div></a>
                        <div class="account-btn">
                            <i class="ti-user"></i>
                            <div class="account-name">Phạm Công Hậu</div>
                            <i class="ti-angle-down" onclick="openUserMenu()"></i>
                            <i class="ti-angle-up" onclick="closeUserMenu()"></i>
                        </div>
    
                        <!-- user menu -->
                        <div class="user-menu">
                            <div class="user-btn" id="profile-btn" onclick="window.location = 'profile.html';">
                                Hồ sơ
                            </div>
                            <div class="user-btn" id="logout-btn">
                                Đăng xuất
                            </div>
                        </div>
                    </div>

                    <!-- form và đề cử -->
                    <div class="modify-and-suggestion">
                        <div class="modify-form">
                            <form action="">
                                <h2 class="form-title">
                                    Chọn thông số mong muốn 
                                </h2>
                                <div class="input-field">
                                    <label for="temp-input">Nhiệt độ: </label>
                                    <select name="temp-input" id="temp-input">
                                        <option value="32">32</option>
                                        <option value="33" selected>33</option>
                                        <option value="34">34</option>
                                        <option value="35">35</option>
                                    </select>
                                </div>
                                <div class="input-field">
                                    <label for="humid-input">Độ ẩm: </label>
                                    <select name="humid-input" id="humid-input">
                                        <option value="63">63</option>
                                        <option value="64">64</option>
                                        <option value="65" selected>65</option>
                                        <option value="66">66</option>
                                    </select>
                                </div>

                                <div class="modify-form-btns">
                                    <a class="decline-btn" href="#">Xác nhận</a>
                                    <a class="accept-btn" href="homepage.html">Hủy</a>
                                </div>
                            </form>
                        </div>

                        <!-- Đề xuất -->
                        <!-- Thông báo -->
                        <div class="noti">
                            <div class="date-time" id="curr-date-time" style="margin-bottom: 20px;">
                                <h2 id="curr-time"></h2>
                                <h3 id="curr-date"></h3>
                            </div>
                            <h3 style="margin-bottom: 20px;">Thông tin kiểm tra hệ thống</h3>
                            <div ng-repeat="noti in notices">
                                <div class="noti-description">
                                    <div class="noti-time"
                                        style="font-size:22px;">
                                        - {{noti.created_at}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- footer bên dưới -->
            <div class="footer">
                <a href="#">Sản phẩm</a>
                <a href="#">Dịch vụ và điều khoản</a>
                <a href="#">Hỗ trợ</a>
                <a href="#">Về chúng tôi</a>
            </div>
            <script>
                function startTime() {
                    const today = new Date();
                    let h = today.getHours();
                    let m = today.getMinutes();
                    let s = today.getSeconds();
                    m = checkTime(m);
                    s = checkTime(s);
                    document.getElementById('curr-date').innerHTML =  h + ":" + m + ":" + s;
                    setTimeout(startTime, 1000);
                }
                function startTime1() {
                    const today = new Date();
                    let d = today.getDate();
                    let m = today.getMonth()+1;
                    let y = today.getFullYear();
                    m = checkTime(m);
                    d = checkTime(d);
                    document.getElementById('curr-time').innerHTML =  d + "/" + m + "/" + y;
                    setTimeout(startTime, 8640000000);
                }
                function checkTime(i) {
                    if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
                    return i;
                }
                angular.module("myapp", [])
                    .controller("recordController", function($scope,$http) {
                        $scope.userName = "Phạm Công Hậu";
                        $scope.notices=[];
                        function checkTime(i) {
                            if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
                            return i;
                        }   
                        function takeTime(){
                        $http.get('http://127.0.0.1:5000/time').
                         success(function(data, status, headers, config) {
                            $scope.notices=JSON.parse(data["time"]);
                            console.log($scope.notices);
                            for(var i=0;i<$scope.notices.length;i++){
                                var date= new Date($scope.notices[i].created_at);
                                var s=checkTime(date.getSeconds());
                                var m=checkTime(date.getMinutes());
                                var h=checkTime(date.getHours());
                                var d=checkTime(date.getDate());
                                var M= checkTime((date.getMonth() + 1));
                                var y=date.getFullYear();
                                var timeN= d+ "/" + M + "/" + y +"   "+h+ ":" + m+":"+s;
                                $scope.notices[i].created_at=timeN;
                            }
                        }).
                        error(function(data, status, headers, config) {
                        });
                        }
                    
                        takeTime();
                        $scope.tempNow="33";
                        $scope.hummidNow="85";
                        $scope.lastTime="21/5/2022 10:28:28";
                        $scope.check=function(){
                            $http.get('http://127.0.0.1:5000/check').
                         success(function(data, status, headers, config) {
                            //  jQuery("#content-body").showLoading();
                             takeTime();
                            //  jQuery("#content-body").hideLoading();
                        }).
                        error(function(data, status, headers, config) {
                        });
                        }
                        // jQuery("#content-body").hideLoading();
                    });
            </script>
        </div>
        <script src="./js/userMenu.js"></script>
    </body>
</html>